# Enso Atlas multi-project configuration (source of truth)
#
# File structure:
# - foundation_models: global embedding model definitions.
# - classification_models: global prediction model definitions with compatibility metadata.
# - projects: per-cancer/per-task configurations that reference the global model catalogs.
#
# To add a new cancer type or task:
# 1) Add or reference a foundation model under foundation_models.
# 2) Add classification model entries under classification_models.
# 3) Add a project under projects with dataset paths under data/projects/<project_id>/...
#    and list the project's allowed classification_models.
#
# Keep path/layout conventions aligned with TECHNICAL_SPECIFICATION.md.
#
# Operational guardrails:
# - Use project-scoped paths only: data/projects/<project_id>/{slides,embeddings,labels.*}
# - Keep top-level embeddings (*.npy + *_coords.npy) synchronized with embeddings/level0/
#   to preserve strict level-0 endpoint behavior (/api/analyze-multi, heatmap APIs).
# - After embedding updates/migrations, run:
#     python scripts/validate_project_modularity.py --check-embedding-layout
# - For public tunnel deployments, keep frontend API same-origin by leaving
#   NEXT_PUBLIC_API_URL empty (avoid private/Tailnet URLs in browser-facing builds).

# Global foundation model definitions (referenced by projects)
foundation_models:
  path_foundation:
    name: "Path Foundation"
    embedding_dim: 384
    description: "Google Health pathology foundation model (ViT-S, 384-dim)"
  dinov2:
    name: "DINOv2"
    embedding_dim: 768
    description: "Meta DINOv2 self-supervised vision transformer (768-dim)"
  uni:
    name: "UNI"
    embedding_dim: 1024
    description: "Mass General pathology foundation model (1024-dim)"
  conch:
    name: "CONCH"
    embedding_dim: 512
    description: "Contrastive learning pathology model (512-dim)"

# Global classification model definitions (referenced by projects)
classification_models:
  lung_stage:
    model_dir: "luad_transmil_stage"
    display_name: "Tumor Stage"
    description: "Predicts pathologic stage (early vs advanced)"
    auc: 0.648
    n_slides: 130
    category: "lung_cancer"
    positive_label: "Advanced (III/IV)"
    negative_label: "Early (I/II)"
    compatible_foundation: "path_foundation"
  platinum_sensitivity:
    model_dir: "transmil_v2"
    display_name: "Platinum Sensitivity"
    description: "Predicts response to platinum-based chemotherapy"
    auc: 0.907
    n_slides: 199
    category: "ovarian_cancer"
    positive_label: "Sensitive"
    negative_label: "Resistant"
    compatible_foundation: "path_foundation"
  tumor_grade:
    model_dir: "transmil_grade"
    display_name: "Tumor Grade"
    description: "Predicts tumor grade (high vs low grade)"
    auc: 0.752
    n_slides: 918
    category: "general_pathology"
    positive_label: "High Grade"
    negative_label: "Low Grade"
    compatible_foundation: "path_foundation"
  survival_5y:
    model_dir: "transmil_surv5y"
    display_name: "5-Year Survival"
    description: "Predicts 5-year overall survival probability"
    auc: 0.697
    n_slides: 965
    category: "ovarian_cancer"
    positive_label: "Survived"
    negative_label: "Deceased"
    compatible_foundation: "path_foundation"
  survival_3y:
    model_dir: "transmil_full"
    display_name: "3-Year Survival"
    description: "Predicts 3-year overall survival probability"
    auc: 0.645
    n_slides: 1106
    category: "ovarian_cancer"
    positive_label: "Survived"
    negative_label: "Deceased"
    compatible_foundation: "path_foundation"
  survival_1y:
    model_dir: "transmil_surv1y"
    display_name: "1-Year Survival"
    description: "Predicts 1-year overall survival probability"
    auc: 0.639
    n_slides: 1135
    category: "ovarian_cancer"
    positive_label: "Survived"
    negative_label: "Deceased"
    compatible_foundation: "path_foundation"

projects:
  ovarian-platinum:
    name: "Ovarian Cancer - Platinum Sensitivity"
    cancer_type: Ovarian Cancer
    prediction_target: platinum_sensitivity
    classes: ["resistant", "sensitive"]
    positive_class: sensitive
    description: "Predicts platinum-based chemotherapy sensitivity in high-grade serous ovarian carcinoma"
    dataset_source: "TCGA"
    disclaimer: >-
      These predictions are from research models. Model reliability varies by
      AUC score. Clinical decisions should integrate multiple factors including
      patient history, other biomarkers, and clinician expertise.
    foundation_model: path_foundation
    dataset:
      slides_dir: data/projects/ovarian-platinum/slides
      embeddings_dir: data/projects/ovarian-platinum/embeddings
      labels_file: data/projects/ovarian-platinum/labels.csv
      label_column: platinum_sensitivity
    models:
      embedder: path-foundation
      mil_architecture: transmil
      mil_checkpoint: models/transmil_best.pt
      report_generator: medgemma-4b
      semantic_search: medsiglip
    classification_models:
      - platinum_sensitivity
      - tumor_grade
      - survival_5y
      - survival_3y
      - survival_1y
    features:
      medgemma_reports: true
      medsiglip_search: true
      semantic_search: true
    threshold: 0.9229
    threshold_config: models/threshold_config.json

  lung-stage:
    name: "Lung Adenocarcinoma - Stage Classification"
    cancer_type: Lung Cancer
    prediction_target: tumor_stage
    classes: ["early", "advanced"]
    positive_class: advanced
    description: "Predicts pathologic stage (early I/II vs advanced III/IV) in lung adenocarcinoma"
    dataset_source: "TCGA"
    disclaimer: >-
      These predictions are from research models. Model reliability varies by
      AUC score. Clinical decisions should integrate multiple factors including
      patient history, other biomarkers, and clinician expertise.
    foundation_model: path_foundation
    dataset:
      slides_dir: data/projects/lung-stage/slides
      embeddings_dir: data/projects/lung-stage/embeddings
      labels_file: data/projects/lung-stage/labels.json
      label_column: tumor_stage
    models:
      embedder: path-foundation
      mil_architecture: transmil
      mil_checkpoint: outputs/luad_transmil_stage/best_model.pt
      report_generator: medgemma-4b
      semantic_search: medsiglip
    classification_models:
      - lung_stage
    features:
      medgemma_reports: true
      medsiglip_search: false
      semantic_search: false
    threshold: 0.5
